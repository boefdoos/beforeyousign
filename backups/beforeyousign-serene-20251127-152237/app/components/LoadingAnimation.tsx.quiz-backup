'use client'

import { useState, useEffect } from 'react'
import { useI18n } from './i18n-context'

const loadingQuotes = {
  nl: [
    "Royalties checken... ğŸ’°",
    "Naburige rechten nakijken... ğŸµ",
    "Contract clausules ontcijferen... ğŸ”",
    "Rode vlaggen zoeken... ğŸš©",
    "Muziekadvocaat mode: ACTIEF âš–ï¸",
    "360-deals vermijden... ğŸ¯",
    "Billijke vergoeding berekenen... ğŸ§®",
    "PlayRight consulteren... ğŸ“",
    "Kleine lettertjes lezen... ğŸ‘“",
    "Masterrechten beschermen... ğŸ›¡ï¸",
  ],
  fr: [
    "VÃ©rification des royalties... ğŸ’°",
    "ContrÃ´le des droits voisins... ğŸµ",
    "DÃ©cryptage des clauses... ğŸ”",
    "Recherche de drapeaux rouges... ğŸš©",
    "Mode avocat musical: ACTIF âš–ï¸",
    "Ã‰viter les deals 360... ğŸ¯",
    "Calcul rÃ©munÃ©ration Ã©quitable... ğŸ§®",
    "Consultation PlayRight... ğŸ“",
    "Lecture des petits caractÃ¨res... ğŸ‘“",
    "Protection des masters... ğŸ›¡ï¸",
  ],
  en: [
    "Checking royalties... ğŸ’°",
    "Reviewing neighboring rights... ğŸµ",
    "Decoding contract clauses... ğŸ”",
    "Hunting for red flags... ğŸš©",
    "Music lawyer mode: ACTIVE âš–ï¸",
    "Avoiding 360 deals... ğŸ¯",
    "Calculating fair compensation... ğŸ§®",
    "Consulting PlayRight... ğŸ“",
    "Reading the fine print... ğŸ‘“",
    "Protecting masters... ğŸ›¡ï¸",
  ],
}

const triviaQuestions = {
  nl: [
    {
      question: "Wat is een standaard booking agent commissie?",
      answers: ["5%", "10-15%", "25%", "50%"],
      correct: 1,
      explanation: "10-15% is standaard, en komt BOVENOP de artist fee!"
    },
    {
      question: "Wat zijn 'naburige rechten'?",
      answers: ["Rechten van je buren", "Rechten van uitvoerende kunstenaars", "Rechten van componisten", "Geen idee"],
      correct: 1,
      explanation: "Naburige rechten zijn de rechten van uitvoerende kunstenaars (zangers, muzikanten) - PlayRight beheert deze!"
    },
    {
      question: "Wat is een '360 deal'?",
      answers: ["Een complete draai maken", "Label verdient aan ALLES", "Een ronde tafel vergadering", "Een tournee"],
      correct: 1,
      explanation: "Bij een 360 deal verdient het label aan alle inkomsten (merch, touring, sync, etc.) - niet alleen muziek!"
    },
    {
      question: "Wie beheert auteursrechten in BelgiÃ«?",
      answers: ["PlayRight", "SABAM", "Spotify", "De overheid"],
      correct: 1,
      explanation: "SABAM beheert auteursrechten (componisten), PlayRight beheert naburige rechten (uitvoerders)!"
    },
    {
      question: "Wat is 'recoupment' in een deal?",
      answers: ["Een bonus", "Kosten terugverdienen", "Een clausule", "Een feestje"],
      correct: 1,
      explanation: "Recoupment betekent dat je label eerst alle kosten terugverdient voordat JIJ iets krijgt. Let op!"
    }
  ],
  fr: [
    {
      question: "Quelle est la commission standard d'un booking agent?",
      answers: ["5%", "10-15%", "25%", "50%"],
      correct: 1,
      explanation: "10-15% est standard, et vient EN PLUS du cachet de l'artiste!"
    },
    {
      question: "Que sont les 'droits voisins'?",
      answers: ["Droits des voisins", "Droits des interprÃ¨tes", "Droits des compositeurs", "Aucune idÃ©e"],
      correct: 1,
      explanation: "Les droits voisins sont les droits des artistes interprÃ¨tes (chanteurs, musiciens) - PlayRight les gÃ¨re!"
    },
    {
      question: "Qu'est-ce qu'un 'deal 360'?",
      answers: ["Faire un tour complet", "Le label gagne sur TOUT", "Une rÃ©union", "Une tournÃ©e"],
      correct: 1,
      explanation: "Dans un deal 360, le label gagne sur tous les revenus (merch, tournÃ©es, sync, etc.) - pas seulement la musique!"
    },
    {
      question: "Qui gÃ¨re les droits d'auteur en Belgique?",
      answers: ["PlayRight", "SABAM", "Spotify", "Le gouvernement"],
      correct: 1,
      explanation: "La SABAM gÃ¨re les droits d'auteur (compositeurs), PlayRight gÃ¨re les droits voisins (interprÃ¨tes)!"
    },
    {
      question: "Qu'est-ce que le 'recoupment' dans un deal?",
      answers: ["Un bonus", "RÃ©cupÃ©rer les coÃ»ts", "Une clause", "Une fÃªte"],
      correct: 1,
      explanation: "Recoupment signifie que le label rÃ©cupÃ¨re d'abord tous les coÃ»ts avant que VOUS ne gagniez quoi que ce soit. Attention!"
    }
  ],
  en: [
    {
      question: "What's a standard booking agent commission?",
      answers: ["5%", "10-15%", "25%", "50%"],
      correct: 1,
      explanation: "10-15% is standard, and comes ON TOP of the artist fee!"
    },
    {
      question: "What are 'neighboring rights'?",
      answers: ["Rights of neighbors", "Rights of performers", "Rights of composers", "No clue"],
      correct: 1,
      explanation: "Neighboring rights are the rights of performing artists (singers, musicians) - PlayRight manages these!"
    },
    {
      question: "What's a '360 deal'?",
      answers: ["Making a full turn", "Label earns from EVERYTHING", "A round table meeting", "A tour"],
      correct: 1,
      explanation: "In a 360 deal, the label earns from all income (merch, touring, sync, etc.) - not just music!"
    },
    {
      question: "Who manages copyrights in Belgium?",
      answers: ["PlayRight", "SABAM", "Spotify", "The government"],
      correct: 1,
      explanation: "SABAM manages copyrights (composers), PlayRight manages neighboring rights (performers)!"
    },
    {
      question: "What is 'recoupment' in a deal?",
      answers: ["A bonus", "Recovering costs", "A clause", "A party"],
      correct: 1,
      explanation: "Recoupment means the label first recovers all costs before YOU earn anything. Watch out!"
    }
  ]
}

export default function LoadingAnimation() {
  const { language } = useI18n()
  const [currentQuote, setCurrentQuote] = useState(0)
  const [progress, setProgress] = useState(0)
  
  // Trivia game state
  const [currentQuestion, setCurrentQuestion] = useState(0)
  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)
  const [showExplanation, setShowExplanation] = useState(false)
  const [score, setScore] = useState(0)
  
  const quotes = loadingQuotes[language]
  const questions = triviaQuestions[language]
  const question = questions[currentQuestion]

  useEffect(() => {
    // Rotate quotes every 4 seconds (was 2)
    const quoteInterval = setInterval(() => {
      setCurrentQuote((prev) => (prev + 1) % quotes.length)
    }, 4000)

    // Simulate progress (but it's actually waiting for API)
    const progressInterval = setInterval(() => {
      setProgress((prev) => {
        if (prev >= 95) return prev // Don't go to 100%
        return prev + Math.random() * 2
      })
    }, 500)

    return () => {
      clearInterval(quoteInterval)
      clearInterval(progressInterval)
    }
  }, [quotes.length])

  const handleAnswer = (answerIndex: number) => {
    if (selectedAnswer !== null) return // Already answered
    
    setSelectedAnswer(answerIndex)
    setShowExplanation(true)
    
    if (answerIndex === question.correct) {
      setScore(score + 1)
    }
    
    // Move to next question after 3 seconds
    setTimeout(() => {
      if (currentQuestion < questions.length - 1) {
        setCurrentQuestion(currentQuestion + 1)
        setSelectedAnswer(null)
        setShowExplanation(false)
      }
    }, 3000)
  }

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        {/* Animated music note */}
        <div className="flex justify-center mb-6">
          <div className="relative">
            {/* Bouncing notes */}
            <svg 
              className="w-16 h-16 text-orange-500 animate-bounce"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
            </svg>
            
            {/* Pulsing circle */}
            <div className="absolute -top-2 -right-2 w-6 h-6 bg-orange-400 rounded-full animate-ping"></div>
          </div>
        </div>

        {/* Title */}
        <h3 className="text-2xl font-bold text-center mb-2 text-gray-900">
          {language === 'nl' ? 'Contract analyseren...' :
           language === 'fr' ? 'Analyse du contrat...' :
           'Analyzing contract...'}
        </h3>

        {/* Rotating quote */}
        <p className="text-center text-gray-600 mb-6 h-6 transition-all duration-300">
          {quotes[currentQuote]}
        </p>

        {/* Progress bar */}
        <div className="relative mb-6">
          <div className="h-3 bg-gray-200 rounded-full overflow-hidden">
            <div 
              className="h-full bg-gradient-to-r from-orange-400 via-orange-500 to-orange-600 transition-all duration-300 ease-out relative"
              style={{ width: `${progress}%` }}
            >
              {/* Shimmer effect */}
              <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"></div>
            </div>
          </div>
          
          {/* Percentage */}
          <div className="text-center mt-2 text-sm font-semibold text-orange-600">
            {Math.round(progress)}%
          </div>
        </div>

        {/* Trivia Game */}
        <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-6 border-2 border-purple-200 mb-4">
          <div className="flex items-center justify-between mb-4">
            <h4 className="font-bold text-purple-900 flex items-center gap-2">
              <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              {language === 'nl' ? 'Music Rights Trivia' :
               language === 'fr' ? 'Quiz Droits Musicaux' :
               'Music Rights Trivia'}
            </h4>
            <div className="text-sm font-bold text-purple-600">
              {score}/{questions.length}
            </div>
          </div>
          
          <p className="font-semibold text-gray-900 mb-3">
            {question.question}
          </p>
          
          <div className="space-y-2">
            {question.answers.map((answer, index) => {
              const isCorrect = index === question.correct
              const isSelected = index === selectedAnswer
              const showResult = selectedAnswer !== null
              
              let buttonClass = "w-full text-left p-3 rounded-lg font-medium transition-all border-2 "
              
              if (!showResult) {
                buttonClass += "bg-white hover:bg-purple-100 border-purple-200 hover:border-purple-400 text-gray-900"
              } else if (isSelected && isCorrect) {
                buttonClass += "bg-green-100 border-green-400 text-green-900"
              } else if (isSelected && !isCorrect) {
                buttonClass += "bg-red-100 border-red-400 text-red-900"
              } else if (isCorrect) {
                buttonClass += "bg-green-50 border-green-300 text-green-900"
              } else {
                buttonClass += "bg-gray-100 border-gray-200 text-gray-600"
              }
              
              return (
                <button
                  key={index}
                  onClick={() => handleAnswer(index)}
                  disabled={selectedAnswer !== null}
                  className={buttonClass}
                >
                  <div className="flex items-center gap-3">
                    <div className="w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0">
                      {showResult && isCorrect && (
                        <svg className="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                        </svg>
                      )}
                      {showResult && isSelected && !isCorrect && (
                        <svg className="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                        </svg>
                      )}
                    </div>
                    {answer}
                  </div>
                </button>
              )
            })}
          </div>
          
          {showExplanation && (
            <div className="mt-4 p-3 bg-white rounded-lg border-2 border-purple-200">
              <p className="text-sm text-gray-700">
                <span className="font-bold text-purple-900">
                  {language === 'nl' ? 'ğŸ’¡ Wist je dat? ' :
                   language === 'fr' ? 'ğŸ’¡ Le saviez-vous? ' :
                   'ğŸ’¡ Did you know? '}
                </span>
                {question.explanation}
              </p>
            </div>
          )}
        </div>

        {/* Fun fact */}
        <div className="bg-orange-50 border border-orange-200 rounded-lg p-3 text-xs text-orange-800">
          <span className="font-semibold">
            {language === 'nl' ? 'â±ï¸ Even geduld... ' :
             language === 'fr' ? 'â±ï¸ Un instant... ' :
             'â±ï¸ Hang tight... '}
          </span>
          {language === 'nl' ? 'Claude AI analyseert nu alle clausules in je contract. Dit kan 30-60 seconden duren.' :
           language === 'fr' ? 'Claude AI analyse toutes les clauses de votre contrat. Cela peut prendre 30-60 secondes.' :
           'Claude AI is analyzing all clauses in your contract. This may take 30-60 seconds.'}
        </div>
      </div>
    </div>
  )
}
